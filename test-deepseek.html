<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeekæ¨¡å‹æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .test-box {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        input, textarea, button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.02);
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .loading { background: rgba(255, 193, 7, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  DeepSeekæ¨¡å‹æµ‹è¯•å·¥å…·</h1>
        
        <div class="test-box">
            <h3>ğŸ“¡ è¿æ¥æµ‹è¯•</h3>
            <input type="text" id="endpoint" value="http://localhost:11434" placeholder="OllamaæœåŠ¡åœ°å€">
            <input type="text" id="model" value="deepseek-r1:1.5b" placeholder="æ¨¡å‹åç§°">
            <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
            <div id="connectionResult"></div>
        </div>

        <div class="test-box">
            <h3>ğŸ§ª åŸºç¡€å“åº”æµ‹è¯•</h3>
            <p>å…ˆæµ‹è¯•æœ€ç®€å•çš„å¯¹è¯ï¼ŒéªŒè¯æ¨¡å‹åŸºæœ¬åŠŸèƒ½</p>
            <button onclick="testBasicResponse()">æµ‹è¯•åŸºç¡€å¯¹è¯</button>
            <button onclick="testAlternativeModels()" style="background: linear-gradient(45deg, #4CAF50, #45a049); margin-top: 10px;">æµ‹è¯•æ›¿ä»£æ¨¡å‹</button>
            <div id="basicResult"></div>
        </div>

        <div class="test-box">
            <h3>âœï¸ å†™ä½œèƒ½åŠ›æµ‹è¯•</h3>
            <textarea id="testPrompt" rows="4" placeholder="è¾“å…¥æµ‹è¯•é¢˜ç›®ï¼Œä¾‹å¦‚ï¼šå˜å½¢è®°">å˜å½¢è®°</textarea>
            <button onclick="testWritingAbility()">æµ‹è¯•å†™ä½œåˆ†æ</button>
            <div id="writingResult"></div>
        </div>

        <div class="test-box">
            <h3>ğŸ¯ è§’åº¦ç”Ÿæˆæµ‹è¯•</h3>
            <button onclick="testAngleGeneration()">æµ‹è¯•å¤šè§’åº¦åˆ†æ</button>
            <div id="angleResult"></div>
        </div>

        <div class="test-box">
            <h3>ğŸ“ å¤§çº²ç”Ÿæˆæµ‹è¯•</h3>
            <input type="text" id="selectedAngle" value="å°è™«å­å˜æˆè´è¶" placeholder="é€‰æ‹©çš„å†™ä½œè§’åº¦">
            <button onclick="testOutlineGeneration()">æµ‹è¯•å¤§çº²ç”Ÿæˆ</button>
            <div id="outlineResult"></div>
        </div>
    </div>

    <script>
        const endpoint = () => document.getElementById('endpoint').value;
        const model = () => document.getElementById('model').value;

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result">${content}</div>`;
        }

        async function testConnection() {
            showStatus('connectionResult', 'ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...', 'loading');
            
            try {
                const response = await fetch(`${endpoint()}/api/tags`);
                if (response.ok) {
                    const data = await response.json();
                    const models = data.models.map(m => m.name).join(', ');
                    showStatus('connectionResult', 'âœ… è¿æ¥æˆåŠŸï¼', 'success');
                    showResult('connectionResult', `å¯ç”¨æ¨¡å‹ï¼š${models}`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showStatus('connectionResult', `âŒ è¿æ¥å¤±è´¥ï¼š${error.message}`, 'error');
                showResult('connectionResult', 'è¯·ç¡®ä¿Ollamaæ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”æœåŠ¡åœ°å€æ­£ç¡®');
            }
        }

        async function callOllama(prompt, systemPrompt = '', options = {}) {
            const requestBody = {
                model: model(),
                prompt: prompt,
                stream: false,
                options: {
                    temperature: options.temperature || 0.7,
                    top_p: options.top_p || 0.9,
                    num_predict: options.num_predict || 100,
                    num_ctx: options.num_ctx || 1024,
                    num_thread: options.num_thread || 4,
                    ...options
                }
            };
            
            if (systemPrompt) {
                requestBody.system = systemPrompt;
            }

            const response = await fetch(`${endpoint()}/api/generate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.response;
        }

        async function testBasicResponse() {
            showStatus('basicResult', 'ğŸ”„ æ­£åœ¨æµ‹è¯•åŸºç¡€å¯¹è¯...', 'loading');
            const startTime = Date.now();

            try {
                // æœ€ç®€å•çš„æµ‹è¯•
                const result = await callOllama('ä½ å¥½', '', {
                    num_predict: 20,  // åªç”Ÿæˆ20ä¸ªtoken
                    temperature: 0.3   // é™ä½éšæœºæ€§
                });
                
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);
                
                showStatus('basicResult', `âœ… åŸºç¡€æµ‹è¯•æˆåŠŸï¼è€—æ—¶ï¼š${duration}ç§’`, 'success');
                showResult('basicResult', `AIå›å¤ï¼š${result}`);
            } catch (error) {
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);
                showStatus('basicResult', `âŒ åŸºç¡€æµ‹è¯•å¤±è´¥ï¼ˆ${duration}ç§’ï¼‰ï¼š${error.message}`, 'error');
                
                // æä¾›è¯Šæ–­å»ºè®®
                if (error.message.includes('timeout') || duration > 30) {
                    showResult('basicResult', 'è¯Šæ–­ï¼šæ¨¡å‹å“åº”è¶…æ—¶ï¼Œå¯èƒ½åŸå› ï¼š\n1. æ¨¡å‹é¦–æ¬¡åŠ è½½éœ€è¦æ—¶é—´\n2. ç³»ç»Ÿèµ„æºä¸è¶³\n3. å»ºè®®å°è¯•æ›´è½»é‡çš„æ¨¡å‹');
                } else if (error.message.includes('500')) {
                    showResult('basicResult', 'è¯Šæ–­ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œå¯èƒ½åŸå› ï¼š\n1. OllamaæœåŠ¡å¼‚å¸¸\n2. æ¨¡å‹æ–‡ä»¶æŸå\n3. å†…å­˜ä¸è¶³');
                } else {
                    showResult('basicResult', `è¯Šæ–­ï¼š${error.message}\nå»ºè®®æ£€æŸ¥OllamaæœåŠ¡çŠ¶æ€`);
                }
            }
        }

        async function testWritingAbility() {
            const topic = document.getElementById('testPrompt').value;
            showStatus('writingResult', 'ğŸ”„ æ­£åœ¨åˆ†æé¢˜ç›®...', 'loading');

            try {
                const systemPrompt = 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è¯­æ–‡å†™ä½œæŒ‡å¯¼è€å¸ˆï¼Œè¯·åˆ†æç»™å®šçš„ä½œæ–‡é¢˜ç›®ï¼Œç»™å‡ºæ”¹è¿›å»ºè®®ã€‚';
                const prompt = `è¯·åˆ†æè¿™ä¸ªä½œæ–‡é¢˜ç›®ï¼š"${topic}"
                
è¯·ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œåˆ†æï¼š
1. é¢˜ç›®çš„ä¼˜ç‚¹å’Œç‰¹è‰²
2. å¯èƒ½å­˜åœ¨çš„é—®é¢˜æˆ–æ”¹è¿›ç©ºé—´
3. å†™ä½œå»ºè®®å’Œæ³¨æ„äº‹é¡¹

è¯·ç”¨ç®€æ´æ˜äº†çš„ä¸­æ–‡å›ç­”ã€‚`;

                const result = await callOllama(prompt, systemPrompt);
                showStatus('writingResult', 'âœ… åˆ†æå®Œæˆï¼', 'success');
                showResult('writingResult', result);
            } catch (error) {
                showStatus('writingResult', `âŒ åˆ†æå¤±è´¥ï¼š${error.message}`, 'error');
            }
        }

        async function testAngleGeneration() {
            const topic = document.getElementById('testPrompt').value;
            showStatus('angleResult', 'ğŸ”„ æ­£åœ¨ç”Ÿæˆå†™ä½œè§’åº¦...', 'loading');

            try {
                const systemPrompt = 'ä½ æ˜¯ä¸€ä½åˆ›æ„å†™ä½œæŒ‡å¯¼è€å¸ˆï¼Œæ“…é•¿ä»å¤šä¸ªè§’åº¦åˆ†æä½œæ–‡é¢˜ç›®ã€‚';
                const prompt = `é’ˆå¯¹ä½œæ–‡é¢˜ç›®"${topic}"ï¼Œè¯·æä¾›5ä¸ªä¸åŒçš„å†™ä½œè§’åº¦ï¼Œæ¯ä¸ªè§’åº¦è¦æ–°é¢–æœ‰è¶£ã€‚

æ ¼å¼è¦æ±‚ï¼š
1. [è§’åº¦åç§°]ï¼šç®€è¦æè¿°
2. [è§’åº¦åç§°]ï¼šç®€è¦æè¿°
3. [è§’åº¦åç§°]ï¼šç®€è¦æè¿°
4. [è§’åº¦åç§°]ï¼šç®€è¦æè¿°
5. [è§’åº¦åç§°]ï¼šç®€è¦æè¿°

è¯·ç¡®ä¿è§’åº¦å…·æœ‰åˆ›æ„æ€§å’Œå¯å†™æ€§ã€‚`;

                const result = await callOllama(prompt, systemPrompt);
                showStatus('angleResult', 'âœ… è§’åº¦ç”Ÿæˆå®Œæˆï¼', 'success');
                showResult('angleResult', result);
            } catch (error) {
                showStatus('angleResult', `âŒ ç”Ÿæˆå¤±è´¥ï¼š${error.message}`, 'error');
            }
        }

        async function testOutlineGeneration() {
            const angle = document.getElementById('selectedAngle').value;
            const topic = document.getElementById('testPrompt').value;
            showStatus('outlineResult', 'ğŸ”„ æ­£åœ¨ç”Ÿæˆå¤§çº²...', 'loading');

            try {
                const systemPrompt = 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä½œæ–‡å¤§çº²è§„åˆ’å¸ˆï¼Œæ“…é•¿è®¾è®¡æ¸…æ™°çš„æ–‡ç« ç»“æ„ã€‚';
                const prompt = `è¯·ä¸ºä½œæ–‡é¢˜ç›®"${topic}"ï¼Œå†™ä½œè§’åº¦"${angle}"è®¾è®¡ä¸€ä¸ªè¯¦ç»†çš„å¤§çº²ã€‚

å¤§çº²ç»“æ„ï¼š
## å¼€å¤´æ®µ
- ä¸»è¦å†…å®¹
- å†™ä½œè¦ç‚¹

## ä¸­é—´æ®µï¼ˆ2-3æ®µï¼‰
### ç¬¬ä¸€æ®µ
- ä¸»è¦å†…å®¹
- å†™ä½œè¦ç‚¹

### ç¬¬äºŒæ®µ
- ä¸»è¦å†…å®¹
- å†™ä½œè¦ç‚¹

### ç¬¬ä¸‰æ®µï¼ˆå¯é€‰ï¼‰
- ä¸»è¦å†…å®¹
- å†™ä½œè¦ç‚¹

## ç»“å°¾æ®µ
- ä¸»è¦å†…å®¹
- å†™ä½œè¦ç‚¹

è¯·ç¡®ä¿å¤§çº²é€»è¾‘æ¸…æ™°ï¼Œå†…å®¹å…·ä½“ã€‚`;

                const result = await callOllama(prompt, systemPrompt);
                showStatus('outlineResult', 'âœ… å¤§çº²ç”Ÿæˆå®Œæˆï¼', 'success');
                showResult('outlineResult', result);
            } catch (error) {
                showStatus('outlineResult', `âŒ ç”Ÿæˆå¤±è´¥ï¼š${error.message}`, 'error');
            }
        }

        async function testAlternativeModels() {
            showStatus('basicResult', 'ğŸ”„ æ­£åœ¨æµ‹è¯•æ›¿ä»£æ¨¡å‹...', 'loading');
            
            // æ¨èçš„è½»é‡æ¨¡å‹åˆ—è¡¨
            const lightModels = [
                'qwen2.5:0.5b',
                'llama3.2:1b',
                'gemma2:2b',
                'phi3.5:3.8b'
            ];
            
            let results = 'ğŸ“‹ è½»é‡çº§æ¨¡å‹å»ºè®®ï¼š\n\n';
            
            for (const testModel of lightModels) {
                try {
                    const response = await fetch(`${endpoint()}/api/tags`);
                    const data = await response.json();
                    const available = data.models.some(m => m.name === testModel);
                    
                    if (available) {
                        results += `âœ… ${testModel} - å·²å®‰è£…ï¼Œå¯ç›´æ¥ä½¿ç”¨\n`;
                        // å¿«é€Ÿæµ‹è¯•
                        const originalModel = document.getElementById('model').value;
                        document.getElementById('model').value = testModel;
                        
                        try {
                            const testResult = await callOllama('ä½ å¥½', '', { num_predict: 10 });
                            results += `   æµ‹è¯•å“åº”ï¼š${testResult.substring(0, 50)}...\n`;
                        } catch (e) {
                            results += `   æµ‹è¯•å¤±è´¥ï¼š${e.message}\n`;
                        }
                        
                        document.getElementById('model').value = originalModel;
                    } else {
                        results += `âšª ${testModel} - æœªå®‰è£…ï¼Œå¯æ‰§è¡Œï¼šollama pull ${testModel}\n`;
                    }
                } catch (error) {
                    results += `âŒ ${testModel} - æ£€æŸ¥å¤±è´¥\n`;
                }
            }
            
            results += '\nğŸ’¡ å»ºè®®ï¼šå¦‚æœ DeepSeek å¤ªæ…¢ï¼Œå¯ä»¥å°è¯•å®‰è£…ä¸Šè¿°è½»é‡æ¨¡å‹';
            
            showStatus('basicResult', 'âœ… æ›¿ä»£æ¨¡å‹æ£€æŸ¥å®Œæˆ', 'success');
            showResult('basicResult', results);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>