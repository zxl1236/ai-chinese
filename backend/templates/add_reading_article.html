{% extends "base.html" %}

{% block title %}æ·»åŠ é˜…è¯»æ–‡ç«  - AIè¯­æ–‡å­¦ä¹ åŠ©æ‰‹{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>â• æ·»åŠ é˜…è¯»æ–‡ç« </h1>
    <a href="{{ url_for('content_page.list_reading_articles') }}" class="btn">â† è¿”å›åˆ—è¡¨</a>
</div>

<form method="POST" class="form">
    <div class="card">
        <h2>ğŸ“– åŸºæœ¬ä¿¡æ¯</h2>
        
        <div class="form-group">
            <label for="title">æ–‡ç« æ ‡é¢˜ *</label>
            <input type="text" id="title" name="title" required 
                   placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜ï¼Œå¦‚ï¼šã€Šæ˜¥ã€‹">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="author">ä½œè€…</label>
                <input type="text" id="author" name="author" 
                       placeholder="å¦‚ï¼šæœ±è‡ªæ¸…">
            </div>
            
            <div class="form-group">
                <label for="category">ç±»åˆ« *</label>
                <select id="category" name="category" required>
                    <option value="literature">ğŸ“– ç°ä»£æ–‡å­¦</option>
                    <option value="classical">ğŸ“œ æ–‡è¨€æ–‡</option>
                    <option value="poetry">ğŸ­ è¯—æ­Œ</option>
                    <option value="prose">âœï¸ æ•£æ–‡</option>
                    <option value="novel">ğŸ“š å°è¯´</option>
                    <option value="other">ğŸ“° å…¶ä»–</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="difficulty">éš¾åº¦ç­‰çº§ *</label>
                <select id="difficulty" name="difficulty" required>
                    <option value="1">â­ åˆçº§</option>
                    <option value="2">â­â­ åˆä¸­çº§</option>
                    <option value="3">â­â­â­ ä¸­çº§</option>
                    <option value="4">â­â­â­â­ ä¸­é«˜çº§</option>
                    <option value="5">â­â­â­â­â­ é«˜çº§</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="reading_time">é¢„è®¡é˜…è¯»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                <input type="number" id="reading_time" name="reading_time" 
                       min="1" max="60" placeholder="å¦‚ï¼š5">
            </div>
        </div>
        
        <div class="form-group">
            <label for="tags">æ ‡ç­¾</label>
            <input type="text" id="tags" name="tags" 
                   placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ•£æ–‡,æ˜¥å¤©,è‡ªç„¶">
        </div>
    </div>
    
    <div class="card">
        <h2>ğŸ“ æ–‡ç« å†…å®¹</h2>
        
        <div class="form-group">
            <label for="content">æ–‡ç« æ­£æ–‡ *</label>
            <textarea id="content" name="content" required 
                      rows="15" placeholder="è¯·ç²˜è´´æ–‡ç« å†…å®¹..."
                      style="font-family: 'Microsoft YaHei', serif; line-height: 1.8;"></textarea>
            <small class="form-hint">æ”¯æŒæ®µè½æ¢è¡Œï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—å­—æ•°</small>
        </div>
    </div>
    
    <div class="card">
        <h2>â“ é˜…è¯»é¢˜ç›®</h2>
        <p style="color: #666; margin-bottom: 1rem;">
            ğŸ“ <strong>æç¤ºï¼š</strong>æš‚æ—¶é€šè¿‡è¡¨å•æ·»åŠ åŸºç¡€ä¿¡æ¯ï¼Œé¢˜ç›®å¯åœ¨æ–‡ç« åˆ›å»ºåé€šè¿‡ç¼–è¾‘åŠŸèƒ½æ·»åŠ 
        </p>
        
        <div id="questions-container">
            <div class="question-item">
                <h4>é¢˜ç›® 1</h4>
                
                <div class="form-group">
                    <label>é¢˜ç›®ç±»å‹</label>
                    <select name="questions[0][type]">
                        <option value="single">å•é€‰é¢˜</option>
                        <option value="multiple">å¤šé€‰é¢˜</option>
                        <option value="subjective">ä¸»è§‚é¢˜</option>
                        <option value="ai-analysis">AIåˆ†æé¢˜</option>
                        <option value="creative">åˆ›æ„è¡¨è¾¾é¢˜</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>é¢˜ç›®å†…å®¹</label>
                    <textarea name="questions[0][stem]" rows="3" 
                              placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
                </div>
                
                <div class="form-group options-group">
                    <label>é€‰é¡¹ï¼ˆå•é€‰/å¤šé€‰é¢˜ï¼‰</label>
                    <input type="text" name="questions[0][options][0]" placeholder="A. é€‰é¡¹A">
                    <input type="text" name="questions[0][options][1]" placeholder="B. é€‰é¡¹B">
                    <input type="text" name="questions[0][options][2]" placeholder="C. é€‰é¡¹C">
                    <input type="text" name="questions[0][options][3]" placeholder="D. é€‰é¡¹D">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>æ­£ç¡®ç­”æ¡ˆ</label>
                        <input type="text" name="questions[0][answer]" 
                               placeholder="å¦‚ï¼šA æˆ– ä¸»è§‚é¢˜ç­”æ¡ˆè¦ç‚¹">
                    </div>
                    
                    <div class="form-group">
                        <label>åˆ†å€¼</label>
                        <input type="number" name="questions[0][score]" 
                               value="3" min="1" max="20">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ç­”æ¡ˆè§£æ</label>
                    <textarea name="questions[0][explanation]" rows="2" 
                              placeholder="è¯·è¾“å…¥ç­”æ¡ˆè§£æ..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>AIæç¤º</label>
                    <input type="text" name="questions[0][ai_tip]" 
                           placeholder="ğŸ’¡ AIæç¤ºï¼š...">
                </div>
            </div>
        </div>
        
        <button type="button" onclick="addQuestion()" class="btn">â• æ·»åŠ é¢˜ç›®</button>
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn btn-success">ğŸ’¾ ä¿å­˜æ–‡ç« </button>
        <a href="{{ url_for('content_page.list_reading_articles') }}" class="btn">å–æ¶ˆ</a>
    </div>
</form>

<style>
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}

.question-item {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    background: #f9f9f9;
}

.question-item h4 {
    margin: 0 0 1rem 0;
    color: #333;
}

.options-group input {
    margin-bottom: 0.5rem;
}

.form-hint {
    color: #666;
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-start;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #ddd;
}
</style>

<script>
let questionCount = 1;

function addQuestion() {
    const container = document.getElementById('questions-container');
    const questionHtml = `
        <div class="question-item">
            <h4>é¢˜ç›® ${questionCount + 1} <button type="button" onclick="removeQuestion(this)" class="btn btn-sm" style="background: #f44336; color: white;">åˆ é™¤</button></h4>
            
            <div class="form-group">
                <label>é¢˜ç›®ç±»å‹</label>
                <select name="questions[${questionCount}][type]">
                    <option value="single">å•é€‰é¢˜</option>
                    <option value="multiple">å¤šé€‰é¢˜</option>
                    <option value="subjective">ä¸»è§‚é¢˜</option>
                    <option value="ai-analysis">AIåˆ†æé¢˜</option>
                    <option value="creative">åˆ›æ„è¡¨è¾¾é¢˜</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>é¢˜ç›®å†…å®¹</label>
                <textarea name="questions[${questionCount}][stem]" rows="3" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
            </div>
            
            <div class="form-group options-group">
                <label>é€‰é¡¹ï¼ˆå•é€‰/å¤šé€‰é¢˜ï¼‰</label>
                <input type="text" name="questions[${questionCount}][options][0]" placeholder="A. é€‰é¡¹A">
                <input type="text" name="questions[${questionCount}][options][1]" placeholder="B. é€‰é¡¹B">
                <input type="text" name="questions[${questionCount}][options][2]" placeholder="C. é€‰é¡¹C">
                <input type="text" name="questions[${questionCount}][options][3]" placeholder="D. é€‰é¡¹D">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>æ­£ç¡®ç­”æ¡ˆ</label>
                    <input type="text" name="questions[${questionCount}][answer]" placeholder="å¦‚ï¼šA æˆ– ä¸»è§‚é¢˜ç­”æ¡ˆè¦ç‚¹">
                </div>
                
                <div class="form-group">
                    <label>åˆ†å€¼</label>
                    <input type="number" name="questions[${questionCount}][score]" value="3" min="1" max="20">
                </div>
            </div>
            
            <div class="form-group">
                <label>ç­”æ¡ˆè§£æ</label>
                <textarea name="questions[${questionCount}][explanation]" rows="2" placeholder="è¯·è¾“å…¥ç­”æ¡ˆè§£æ..."></textarea>
            </div>
            
            <div class="form-group">
                <label>AIæç¤º</label>
                <input type="text" name="questions[${questionCount}][ai_tip]" placeholder="ğŸ’¡ AIæç¤ºï¼š...">
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', questionHtml);
    questionCount++;
}

function removeQuestion(button) {
    button.closest('.question-item').remove();
}

// è‡ªåŠ¨è®¡ç®—å­—æ•°
document.getElementById('content').addEventListener('input', function() {
    const content = this.value;
    const wordCount = content.replace(/\s/g, '').length;
    
    // æ›´æ–°å­—æ•°æ˜¾ç¤º
    let hint = this.nextElementSibling;
    if (hint && hint.classList.contains('form-hint')) {
        hint.textContent = `æ”¯æŒæ®µè½æ¢è¡Œï¼Œå½“å‰å­—æ•°ï¼š${wordCount} å­—`;
    }
    
    // ä¼°ç®—é˜…è¯»æ—¶é—´ï¼ˆå¹³å‡æ¯åˆ†é’Ÿ150å­—ï¼‰
    const readingTime = Math.ceil(wordCount / 150);
    const readingTimeInput = document.getElementById('reading_time');
    if (readingTimeInput.value === '' || readingTimeInput.value === '0') {
        readingTimeInput.value = readingTime;
    }
});
</script>
{% endblock %}
