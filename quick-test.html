<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿè¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin: 10px 0;
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            white-space: pre-wrap;
            font-family: monospace;
            min-height: 50px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }
        .success { background: rgba(76, 175, 80, 0.5); }
        .error { background: rgba(244, 67, 54, 0.5); }
        .loading { background: rgba(255, 193, 7, 0.5); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ å¿«é€Ÿè¿æ¥æµ‹è¯•</h1>
        
        <button onclick="testBasicConnection()">1. æµ‹è¯•åŸºç¡€è¿æ¥</button>
        <div id="basic-result"></div>
        
        <button onclick="testModelList()">2. è·å–æ¨¡å‹åˆ—è¡¨</button>
        <div id="models-result"></div>
        
        <button onclick="testSimpleChat()">3. æµ‹è¯•ç®€å•å¯¹è¯</button>
        <div id="chat-result"></div>
        
        <button onclick="testWithSystemPrompt()">4. æµ‹è¯•ç³»ç»Ÿæç¤º</button>
        <div id="system-result"></div>
    </div>

    <script>
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result">${content}</div>`;
        }

        async function testBasicConnection() {
            showStatus('basic-result', 'ğŸ”„ æµ‹è¯•åŸºç¡€è¿æ¥...', 'loading');
            
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                if (response.ok) {
                    const data = await response.json();
                    showStatus('basic-result', 'âœ… åŸºç¡€è¿æ¥æˆåŠŸï¼', 'success');
                    showResult('basic-result', `OllamaæœåŠ¡è¿è¡Œæ­£å¸¸\nå“åº”çŠ¶æ€: ${response.status}\næ•°æ®: ${JSON.stringify(data, null, 2)}`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showStatus('basic-result', 'âŒ åŸºç¡€è¿æ¥å¤±è´¥', 'error');
                showResult('basic-result', `é”™è¯¯: ${error.message}\n\nè¯·ç¡®ä¿ï¼š\n1. Ollamaæ­£åœ¨è¿è¡Œ\n2. ç«¯å£11434å¯è®¿é—®\n3. æ²¡æœ‰é˜²ç«å¢™é˜»æ­¢`);
            }
        }

        async function testModelList() {
            showStatus('models-result', 'ğŸ”„ è·å–æ¨¡å‹åˆ—è¡¨...', 'loading');
            
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                const data = await response.json();
                
                const models = data.models || [];
                const deepseekModels = models.filter(m => m.name.includes('deepseek'));
                
                showStatus('models-result', 'âœ… æ¨¡å‹åˆ—è¡¨è·å–æˆåŠŸï¼', 'success');
                showResult('models-result', `æ€»æ¨¡å‹æ•°: ${models.length}\nDeepSeekæ¨¡å‹: ${deepseekModels.length}\n\næ‰€æœ‰æ¨¡å‹:\n${models.map(m => `- ${m.name} (${m.size})`).join('\n')}\n\nDeepSeekæ¨¡å‹:\n${deepseekModels.map(m => `- ${m.name} (${m.size})`).join('\n')}`);
            } catch (error) {
                showStatus('models-result', 'âŒ è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥', 'error');
                showResult('models-result', `é”™è¯¯: ${error.message}`);
            }
        }

        async function testSimpleChat() {
            showStatus('chat-result', 'ğŸ”„ æµ‹è¯•ç®€å•å¯¹è¯...', 'loading');
            
            try {
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'deepseek-r1:1.5b',
                        prompt: 'ä½ å¥½ï¼Œè¯·ç”¨ä¸­æ–‡å›å¤ï¼šä½ æ˜¯è°ï¼Ÿ',
                        stream: false,
                        options: {
                            temperature: 0.7,
                            top_p: 0.9
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                showStatus('chat-result', 'âœ… å¯¹è¯æµ‹è¯•æˆåŠŸï¼', 'success');
                showResult('chat-result', `æ¨¡å‹å“åº”:\n${data.response}\n\nè€—æ—¶: ${data.total_duration ? Math.round(data.total_duration / 1000000) + 'ms' : 'æœªçŸ¥'}\næç¤ºä»¤ç‰Œ: ${data.prompt_eval_count || 'æœªçŸ¥'}\nå“åº”ä»¤ç‰Œ: ${data.eval_count || 'æœªçŸ¥'}`);
            } catch (error) {
                showStatus('chat-result', 'âŒ å¯¹è¯æµ‹è¯•å¤±è´¥', 'error');
                showResult('chat-result', `é”™è¯¯: ${error.message}\n\nå¯èƒ½åŸå› :\n1. æ¨¡å‹åç§°é”™è¯¯\n2. æ¨¡å‹æœªå¯åŠ¨\n3. ç½‘ç»œè¿æ¥é—®é¢˜`);
            }
        }

        async function testWithSystemPrompt() {
            showStatus('system-result', 'ğŸ”„ æµ‹è¯•å†™ä½œåˆ†æ...', 'loading');
            
            try {
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'deepseek-r1:1.5b',
                        prompt: 'è¯·åˆ†æä½œæ–‡é¢˜ç›®"å˜å½¢è®°"ï¼Œä»ä»¥ä¸‹è§’åº¦ï¼š1.é¢˜ç›®ä¼˜ç‚¹ 2.å¯èƒ½é—®é¢˜ 3.å†™ä½œå»ºè®®ã€‚è¯·ç®€æ´å›ç­”ã€‚',
                        system: 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä¸­å­¦è¯­æ–‡è€å¸ˆï¼Œæ“…é•¿ä½œæ–‡æŒ‡å¯¼ã€‚',
                        stream: false,
                        options: {
                            temperature: 0.7,
                            top_p: 0.9,
                            max_tokens: 1000
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                showStatus('system-result', 'âœ… å†™ä½œåˆ†ææµ‹è¯•æˆåŠŸï¼', 'success');
                showResult('system-result', `AIåˆ†æç»“æœ:\n${data.response}\n\nè¿™è¯æ˜DeepSeekå¯ä»¥ç”¨äºå†™ä½œè¾…å¯¼ï¼`);
            } catch (error) {
                showStatus('system-result', 'âŒ å†™ä½œåˆ†ææµ‹è¯•å¤±è´¥', 'error');
                showResult('system-result', `é”™è¯¯: ${error.message}`);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•åŸºç¡€è¿æ¥
        window.addEventListener('load', () => {
            setTimeout(testBasicConnection, 1000);
        });
    </script>
</body>
</html>